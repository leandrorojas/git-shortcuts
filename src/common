#!/bin/bash

readonly GIT="git"

readonly status="status"
readonly branch="branch"
readonly checkout="checkout"
readonly commit="commit"
readonly push="push"
readonly add="add"
readonly pull="pull"
readonly tag="tag"
readonly stash="stash"
readonly rebase="rebase"
readonly reset="reset"

readonly symbolic_ref="symbolic-ref"

readonly HIDDEN_FILE=".hidden"
readonly commit_flags_a="-a"
readonly commit_flags_m="m"
readonly push_flags="-u"
readonly branch_flags="-D"
readonly tag_flags="-d"
readonly tag_push_delete_flags=":refs/tags/"
readonly tag_push_all_flags="--tags"
readonly rebase_flags="--rebase"
readonly reset_flags="--hard"

readonly origin="origin"

readonly main_branch="main" #TODO: read this from .config

function git_branch(){
    if [[ $# -eq 1 ]]; then
        ${GIT} ${branch} "${1}"
    else
        ${GIT} ${branch}
    fi
}

function git_branch_enum(){
    ${GIT} ${branch} | cut -c 3-
}

function git_checkout(){
    ${GIT} ${checkout} "${1}"
}

function git_commit(){
    ${GIT} ${commit} "${commit_flags_a}""${commit_flags_m}" \""${1}"\"
}

# shellcheck disable=SC2120
function git_push(){
    if [[ $# -eq 1 ]]; then
        ${GIT} ${push} "${push_flags}" "${origin}" "${1}"
    else
        ${GIT} ${push}
    fi
}

function git_status(){
    ${GIT} ${status}
}

function git_add_all(){
    ${GIT} ${add} "-A"
}

function git_stash(){
    ${GIT} ${stash}
}

function git_rebase(){
    ${GIT} ${rebase} "${1}"
}

function git_pull_rebase(){
    ${GIT} ${pull} "${rebase_flags}" "${origin}" "${1}"
}

function git_reset(){
    ${GIT} ${reset} "${reset_flags}"
}

#file
function add_hidden_file(){
    ${GIT} ${add} $HIDDEN_FILE
}

function file_create_control(){
    if [ ! -f $HIDDEN_FILE ]; then
        file_create
    else
        file_remove
    fi
}

function file_create(){
    echo " " > $HIDDEN_FILE
    add_hidden_file
}

function file_remove(){
    rm $HIDDEN_FILE
}

function branch_create(){
    git_branch "${1}"
}

function branch_delete_all(){
    for to_delete in $(git_branch_enum); do
        if [[ $to_delete != "$main_branch" ]]; then
            ${GIT} ${branch} ${branch_flags} "$to_delete"
        fi
    done
}

function get_main(){
    git_checkout ${main_branch}
    ${GIT} ${pull}
}

function tag_copy(){
    ${GIT} ${tag} "${1}" "${2}"
}

function tag_delete(){
    ${GIT} ${tag} ${tag_flags} "${1}"
}

function tag_push_deleted(){
    ${GIT} ${push} ${origin} ${tag_push_delete_flags}"${1}"
}

function tag_push_all(){
    ${GIT} ${push} ${tag_push_all_flags}
}

function increment_send(){
    git_commit "${1}"
    git_push
}

function get_current_branch(){
    ${GIT} ${symbolic_ref} --short -q HEAD
}

function apply_stash(){
    ${GIT} ${stash} apply
}